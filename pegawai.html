<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Pegawai</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        color: #333;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      a {
        color: #3498db;
        text-decoration: none;
        margin-top: 20px;
        font-weight: bold;
      }

      h1 {
        margin-top: 20px;
        color: #2c3e50;
      }

      form {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
      }

      form span {
        display: flex;
        flex-direction: column;
      }

      form label {
        margin-bottom: 5px;
        font-weight: bold;
      }

      form input {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
      }

      form button {
        background-color: #3498db;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        align-self: flex-end;
      }

      form button:hover {
        background-color: #2980b9;
      }

      main {
        margin-top: 20px;
        width: 100%;
        max-width: 800px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background-color: #ffffff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      table th,
      table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
      }

      table th {
        background-color: #3498db;
        color: white;
      }

      table tbody tr:nth-child(odd) {
        background-color: #f9f9f9;
      }

      table tbody tr:hover {
        background-color: #f1f1f1;
      }

      table th[colspan="2"] {
        text-align: center;
      }

      table td button {
        background-color: #e74c3c;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }

      table td button:hover {
        background-color: #c0392b;
      }
    </style>
  </head>
  <body>
    <a href="index.html">Kembali</a>
    <h1>Data Pegawai</h1>
    <form>
      <span>
        <label for="nama">Nama</label>
        <input
          data-id
          id="nama"
          type="text"
          placeholder="Masukkan nama"
          required
        />
      </span>
      <span style="margin-left: 1rem">
        <label for="nip">NIP</label>
        <input
          data-id
          id="nip"
          type="text"
          placeholder="Masukkan NIP"
          required
        />
      </span>
      <button type="submit">Simpan</button>
    </form>
    <main style="margin-top: 1rem">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nama</th>
            <th>NIP</th>
            <th colspan="2">Option</th>
          </tr>
        </thead>
        <tbody id="table-pegawai"></tbody>
      </table>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Ngambil elemen form
      const form = document.querySelector("form");

      // Bikin trigger event submit pada elemen form
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        kirim();
      });

      function kirim() {
        // Ngambil elemen input
        const elemen_nama = document.querySelector("#nama");
        const elemen_nip = document.querySelector("#nip");

        // Ngambil value dari elemen input
        const id = elemen_nama.dataset.id;
        const nama = elemen_nama.value;
        const nip = elemen_nip.value;

        // Ngecek apakah harus POST atau PUT
        if (id == "") {
          // Tambah pegawai
          axios
            .post("https://pegawai-jmw7ojw7cq-et.a.run.app/pegawai", {
              nama,
              nip,
            })
            .then(() => {
              // Bersihin form
              elemen_nama.dataset.id = "";
              elemen_nama.value = "";
              elemen_nip.value = "";

              // Manggil fungsi untuk refresh data pegawai
              getPegawai();
              alert("Pegawai berhasil ditambahkan.");
            })
            .catch((error) => console.log(error.message));
        } else {
          // Edit pegawai
          axios
            .put(`https://pegawai-jmw7ojw7cq-et.a.run.app/pegawai/${id}`, {
              nama,
              nip,
            })
            .then(() => {
              // Bersihin form
              elemen_nama.dataset.id = "";
              elemen_nama.value = "";
              elemen_nip.value = "";

              // Manggil fungsi untuk refresh data pegawai
              getPegawai();
              alert("Pegawai berhasil diupdate.");
            })
            .catch((error) => console.log(error));
        }
      }

      // Ngambil data pegawai
      function getPegawai() {
        axios
          .get("https://pegawai-jmw7ojw7cq-et.a.run.app/pegawai")
          .then(({ data }) => {
            const table = document.querySelector("#table-pegawai");
            const { data: pegawai } = data;
            let tampilan = "";
            let no = 1;

            pegawai.forEach((item) => {
              tampilan += tampilkanPegawai(no, item);
              no++;
            });
            table.innerHTML = tampilan;

            hapusPegawai();
            editPegawai();
          })
          .catch((error) => {
            console.log(error.message);
          });
      }

      function tampilkanPegawai(no, pegawai) {
        return `
                <tr>
                    <td>${no}</td>
                    <td class="nama">${pegawai.nama}</td>
                    <td class="nip">${pegawai.nip}</td>
                    <td><button data-id=${pegawai.id} class='btn-edit'>Edit</button></td>
                    <td><button data-id=${pegawai.id} class='btn-hapus'>Hapus</button></td>
                </tr>
            `;
      }

      function hapusPegawai() {
        const btnHapusList = document.querySelectorAll(".btn-hapus");

        btnHapusList.forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.dataset.id;
            axios
              .delete(`https://pegawai-jmw7ojw7cq-et.a.run.app/pegawai/${id}`)
              .then(() => {
                getPegawai();
                alert("Pegawai berhasil dihapus.");
              })
              .catch((error) => console.log(error));
          });
        });
      }

      function editPegawai() {
        const btnEditList = document.querySelectorAll(".btn-edit");

        btnEditList.forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.dataset.id;
            const nama =
              btn.parentElement.parentElement.querySelector(".nama").innerText;
            const nip =
              btn.parentElement.parentElement.querySelector(".nip").innerText;

            const elemen_nama = document.querySelector("#nama");
            const elemen_nip = document.querySelector("#nip");

            elemen_nama.dataset.id = id;
            elemen_nama.value = nama;
            elemen_nip.value = nip;
          });
        });
      }

      getPegawai();
    </script>
  </body>
</html>
